<!doctype html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible"
          content="IE=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1">
    <title>Joel Vandiver</title>
    <link rel="shortcut icon"
          href="/assets/favicon.ico"
          type="image/x-icon">
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700"
          rel="stylesheet">
    <!-- Bulma Version 0.7.2-->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css" />
    <link rel="stylesheet"
          type="text/css"
          href="/assets/site.css">
  </head>

  <body>
    <section class="hero is-fullheight">
      <div class="hero-head">
        <nav class="navbar">
          <div class="container">
            <div class="navbar-brand">
              <a class="navbar-item is-size-1"
                 href="/">
                JV
              </a>
              <span class="navbar-burger burger"
                    data-target="navbarMenu">
                <span></span>
                <span></span>
                <span></span>
              </span>
            </div>
          </div>
        </nav>
      </div>

      <div class="hero-body">
        <div class="container">
          <div class="columns">
            <div class="column is-4 has-text-centered">
              <h1 class="is-size-1">Joel Vandiver</h1>
              <h2 class="subtitle">
                Full Stack Web Developer
              </h2>
              <ul>
                
  <li><a href=""></a></li>

  <li><a href="/posts/2018/11/10">2018/11/10</a></li>

  <li><a href="/posts/2018/11/11">2018/11/11</a></li>

  <li><a href="/posts/2018/11/17">2018/11/17</a></li>

  <li><a href="/posts/_archive">_archive</a></li>

              </ul>
            </div>
            <div class="column is-8 section">
              <h1>Creating F# HTML Build</h1>
<pre><code class="language-fsharp">#r @"C:\git\joelvandiver.github.io\packages\FSharp.Formatting\lib\net40\FSharp.Markdown.dll"
#r @"C:\git\joelvandiver.github.io\packages\Handlebars.Net\lib\net452\Handlebars.dll"

open System.IO
open FSharp.Core
open FSharp.Markdown
open HandlebarsDotNet

let root = __SOURCE_DIRECTORY__
let postPath = root + @"\posts"
let indexMarkdown = root + @"\index.md"
let indexTemplate = root + @"\index.hbs"

type FileText = 
    {  file : string
       path : string }

let readFileText (path: string)  = 
  { file = File.ReadAllText(path)
    path = path }

let postMds = 
  indexMarkdown :: (Directory.GetFiles(postPath, "*.md", SearchOption.AllDirectories) |&gt; List.ofSeq)
  |&gt; List.map readFileText
  
let private marked (markdown: string): string = markdown |&gt; Markdown.Parse |&gt; Markdown.WriteHtml

let parseMarkedFileText (ft: FileText) : FileText =
  { file = ft.file |&gt; marked
    path = ft.path.Replace(".md", ".html")}

let parsed = postMds |&gt; List.map parseMarkedFileText



type Anchor = 
  { title : string
    url   : string }

let navs : Anchor list =
  parsed
  |&gt; List.map(
      fun ft -&gt; 
        let url = 
          ft.path
            .Replace(root, "")
            .Replace(@"\", "/")
            .Replace("/index.html", "")
        { title = url
                    .Replace("/posts/", "")
                    .Replace("/index", "")
                    .Replace(".html", "")
          url   = url  })
  |&gt; List.filter(fun url -&gt; url.url &lt;&gt; "/index.html")      

type Components = 
  { postnavs : Anchor list 
    post     : string }

let genComponents post = 
  { postnavs = navs
    post = post }

Handlebars.RegisterTemplate("postnav", """
  &lt;li&gt;&lt;a href="{{url}}"&gt;{{title}}&lt;/a&gt;&lt;/li&gt;
""");

let source = File.ReadAllText(indexTemplate)


let genHtml post = 
  let helper (writer: TextWriter) (_: obj) (_: obj) = writer.WriteSafeString(post)
  Handlebars.RegisterHelper("post", HandlebarsHelper(helper))
  let template = Handlebars.Compile(source)
  post
  |&gt; genComponents
  |&gt; template.Invoke

let save () =
  parsed
  |&gt; List.iter(
      fun ft -&gt; 
        printfn "%A" ft
        let html = ft.file |&gt; genHtml
        File.WriteAllText(ft.path, html))

save()


</code></pre>

            </div>
          </div>
        </div>
      </div>

    </section>
  </body>

</html>