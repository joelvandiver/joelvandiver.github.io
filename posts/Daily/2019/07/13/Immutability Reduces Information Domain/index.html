<!DOCTYPE html>
<html data-reactroot="" lang="en"><head><title>Joel Vandiver / Blog</title><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible"/><link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon"/><link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css"/><link rel="stylesheet" type="text/css" href="/assets/css/site.css"/></head><body class="container"><a class="sidebar" href="/"><h1>Joel Vandiver</h1><img src="/assets/fractal-logo.svg"/></a><div class="main"><h1><a name="Immutability-Reduces-Information-Domain" class="anchor" href="#Immutability-Reduces-Information-Domain">Immutability Reduces Information Domain</a></h1>
<p>07-13-2019</p>
<p>I have heard many developers who come from non-functional programming languages such as C++ and C# claim that immutability is overly restrictive.  It is true that immutability is a restrictive, but this restriction comes at one huge benefit:  reduction of possible outcomes.</p>
<p><code>Information</code> may be informally defined as the element of surprise.  The more surprises a system has, the more information it contains.  Note the distinction between actual information and possible information.  Typically as developers we focus our algorithms on the actual information that our system processes.  But, of equal (or greater) concern is of the possible information the system will proccess.  Let's call this the <code>Information Domain</code>.  Effectively, it is the concern of the developer to process the Information Domain.  We have to anticipate all of the possible outcomes of our system.</p>
<p>Mutability at its core allows for surprise.</p>
<p>Let's take a simple mathematical function and restricted domain for example.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, '1', 1)" onmouseover="showTip(event, '1', 1)" class="fn">f</span> <span onmouseout="hideTip(event, '2', 2)" onmouseover="showTip(event, '2', 2)" class="id">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, '2', 3)" onmouseover="showTip(event, '2', 3)" class="id">x</span> <span class="o">+</span> <span class="n">3</span>
<span class="k">let</span> <span onmouseout="hideTip(event, '3', 4)" onmouseover="showTip(event, '3', 4)" class="id">domainX</span> <span class="o">=</span> <span class="pn">[</span><span class="o">-</span><span class="n">2</span><span class="pn">;</span><span class="o">-</span><span class="n">1</span><span class="pn">;</span><span class="n">0</span><span class="pn">;</span><span class="n">1</span><span class="pn">;</span><span class="n">2</span><span class="pn">]</span>
<span class="k">let</span> <span onmouseout="hideTip(event, '4', 5)" onmouseover="showTip(event, '4', 5)" class="id">table</span> <span class="o">=</span> <span onmouseout="hideTip(event, '3', 6)" onmouseover="showTip(event, '3', 6)" class="id">domainX</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, '5', 7)" onmouseover="showTip(event, '5', 7)" class="m">List</span><span class="pn">.</span><span onmouseout="hideTip(event, '6', 8)" onmouseover="showTip(event, '6', 8)" class="id">map</span> <span onmouseout="hideTip(event, '1', 9)" onmouseover="showTip(event, '1', 9)" class="fn">f</span>
 
<span class="c">(*</span>
<span class="c">val f : x:int -&gt; int</span>
<span class="c">val domainX : int list = [-2; -1; 0; 1; 2]</span>
<span class="c">val table : int list = [1; 2; 3; 4; 5]</span>

<span class="c">Now, let&#39;s explore the same function with a mutable side-effect:</span>
<span class="c">*)</span>
 
<span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, '7', 10)" onmouseover="showTip(event, '7', 10)" class="mv">X</span> <span class="o">=</span> <span class="n">4</span>
 
<span class="k">let</span> <span onmouseout="hideTip(event, '8', 11)" onmouseover="showTip(event, '8', 11)" class="fn">f&#39;</span> <span onmouseout="hideTip(event, '2', 12)" onmouseover="showTip(event, '2', 12)" class="id">x</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, '7', 13)" onmouseover="showTip(event, '7', 13)" class="mv">X</span> <span class="k">&lt;-</span> <span onmouseout="hideTip(event, '7', 14)" onmouseover="showTip(event, '7', 14)" class="mv">X</span> <span class="o">+</span> <span class="n">1</span>
    <span onmouseout="hideTip(event, '7', 15)" onmouseover="showTip(event, '7', 15)" class="mv">X</span> <span class="o">+</span> <span onmouseout="hideTip(event, '2', 16)" onmouseover="showTip(event, '2', 16)" class="id">x</span> <span class="o">+</span> <span class="n">3</span>
 
<span class="k">let</span> <span onmouseout="hideTip(event, '9', 17)" onmouseover="showTip(event, '9', 17)" class="id">table&#39;</span> <span class="o">=</span> <span onmouseout="hideTip(event, '3', 18)" onmouseover="showTip(event, '3', 18)" class="id">domainX</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, '5', 19)" onmouseover="showTip(event, '5', 19)" class="m">List</span><span class="pn">.</span><span onmouseout="hideTip(event, '6', 20)" onmouseover="showTip(event, '6', 20)" class="id">map</span> <span onmouseout="hideTip(event, '8', 21)" onmouseover="showTip(event, '8', 21)" class="fn">f&#39;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, '10', 22)" onmouseover="showTip(event, '10', 22)" class="id">table&#39;2</span> <span class="o">=</span> <span onmouseout="hideTip(event, '3', 23)" onmouseover="showTip(event, '3', 23)" class="id">domainX</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, '5', 24)" onmouseover="showTip(event, '5', 24)" class="m">List</span><span class="pn">.</span><span onmouseout="hideTip(event, '6', 25)" onmouseover="showTip(event, '6', 25)" class="id">map</span> <span onmouseout="hideTip(event, '8', 26)" onmouseover="showTip(event, '8', 26)" class="fn">f&#39;</span>
</code></pre></td>
</tr>
</table>
<blockquote>
<p>Output:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">val</span> <span class="k">mutable</span> <span class="id">X</span> <span class="pn">:</span> <span onmouseout="hideTip(event, '11', 27)" onmouseover="showTip(event, '11', 27)" class="id">int</span> <span class="o">=</span> <span class="n">14</span>
<span class="k">val</span> <span class="id">f&#39;</span> <span class="pn">:</span> <span class="id">x</span><span class="pn">:</span><span onmouseout="hideTip(event, '11', 28)" onmouseover="showTip(event, '11', 28)" class="id">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, '11', 29)" onmouseover="showTip(event, '11', 29)" class="id">int</span>
<span class="k">val</span> <span class="id">table&#39;</span> <span class="pn">:</span> <span onmouseout="hideTip(event, '11', 30)" onmouseover="showTip(event, '11', 30)" class="id">int</span> <span onmouseout="hideTip(event, '12', 31)" onmouseover="showTip(event, '12', 31)" class="id">list</span> <span class="o">=</span> <span class="pn">[</span><span class="n">6</span><span class="pn">;</span> <span class="n">8</span><span class="pn">;</span> <span class="n">10</span><span class="pn">;</span> <span class="n">12</span><span class="pn">;</span> <span class="n">14</span><span class="pn">]</span>
<span class="k">val</span> <span class="id">table&#39;2</span> <span class="pn">:</span> <span onmouseout="hideTip(event, '11', 32)" onmouseover="showTip(event, '11', 32)" class="id">int</span> <span onmouseout="hideTip(event, '12', 33)" onmouseover="showTip(event, '12', 33)" class="id">list</span> <span class="o">=</span> <span class="pn">[</span><span class="n">11</span><span class="pn">;</span> <span class="n">13</span><span class="pn">;</span> <span class="n">15</span><span class="pn">;</span> <span class="n">17</span><span class="pn">;</span> <span class="n">19</span><span class="pn">]</span>
</code></pre></td>
</tr>
</table>
<p>Note the <code>table'2</code> has different values from the values in <code>table'</code> as expected.</p>
</blockquote>
<p>This may seem simple when you can <em>read</em> the source code as we are doing here, but if you did not have access to the source code, this behavior would surely be a <strong>surprise</strong>.</p>
<p>The <code>f'</code> can be restructured to make the behavior less of a surprise:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, '13', 34)" onmouseover="showTip(event, '13', 34)" class="fn">f&#39;&#39;</span> <span onmouseout="hideTip(event, '2', 35)" onmouseover="showTip(event, '2', 35)" class="id">x</span> <span onmouseout="hideTip(event, '14', 36)" onmouseover="showTip(event, '14', 36)" class="id">y</span> <span class="o">=</span> <span onmouseout="hideTip(event, '14', 37)" onmouseover="showTip(event, '14', 37)" class="id">y</span> <span class="o">+</span> <span onmouseout="hideTip(event, '2', 38)" onmouseover="showTip(event, '2', 38)" class="id">x</span> <span class="o">+</span> <span class="n">3</span>
</code></pre></td>
</tr>
</table>
<p>Here, we've removed the mutable call, and instead declared a new param, <code>y</code>, that declares the dependency for <code>f''</code> to operate.</p>
<p>Now, we can provide another restricted domain for the <code>y</code> param:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, '15', 39)" onmouseover="showTip(event, '15', 39)" class="id">domainY</span> <span class="o">=</span> <span class="pn">[</span><span class="n">4</span><span class="pn">;</span><span class="n">5</span><span class="pn">;</span><span class="n">6</span><span class="pn">;</span><span class="n">7</span><span class="pn">;</span><span class="n">8</span><span class="pn">;</span><span class="n">9</span><span class="pn">]</span>
</code></pre></td>
</tr>
</table>
<p>This has the effect of combining both <code>domainX</code> and <code>domainY</code> through a cartesian product:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, '16', 40)" onmouseover="showTip(event, '16', 40)" class="id">table&#39;3</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, '3', 41)" onmouseover="showTip(event, '3', 41)" class="id">domainX</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, '5', 42)" onmouseover="showTip(event, '5', 42)" class="m">List</span><span class="pn">.</span><span onmouseout="hideTip(event, '6', 43)" onmouseover="showTip(event, '6', 43)" class="id">map</span><span class="pn">(</span><span class="k">fun</span> <span onmouseout="hideTip(event, '2', 44)" onmouseover="showTip(event, '2', 44)" class="id">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, '15', 45)" onmouseover="showTip(event, '15', 45)" class="id">domainY</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, '5', 46)" onmouseover="showTip(event, '5', 46)" class="m">List</span><span class="pn">.</span><span onmouseout="hideTip(event, '6', 47)" onmouseover="showTip(event, '6', 47)" class="id">map</span> <span class="pn">(</span><span onmouseout="hideTip(event, '13', 48)" onmouseover="showTip(event, '13', 48)" class="fn">f&#39;&#39;</span> <span onmouseout="hideTip(event, '2', 49)" onmouseover="showTip(event, '2', 49)" class="id">x</span><span class="pn">)</span><span class="pn">)</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, '5', 50)" onmouseover="showTip(event, '5', 50)" class="m">List</span><span class="pn">.</span><span onmouseout="hideTip(event, '17', 51)" onmouseover="showTip(event, '17', 51)" class="id">concat</span>
 
</code></pre></td>
</tr>
</table>
<blockquote>
<p>Output:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">val</span> <span class="id">f&#39;&#39;</span> <span class="pn">:</span> <span class="id">x</span><span class="pn">:</span><span onmouseout="hideTip(event, '11', 52)" onmouseover="showTip(event, '11', 52)" class="id">int</span> <span class="k">-&gt;</span> <span class="id">y</span><span class="pn">:</span><span onmouseout="hideTip(event, '11', 53)" onmouseover="showTip(event, '11', 53)" class="id">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, '11', 54)" onmouseover="showTip(event, '11', 54)" class="id">int</span>
<span class="k">val</span> <span class="id">domainY</span> <span class="pn">:</span> <span onmouseout="hideTip(event, '11', 55)" onmouseover="showTip(event, '11', 55)" class="id">int</span> <span onmouseout="hideTip(event, '12', 56)" onmouseover="showTip(event, '12', 56)" class="id">list</span> <span class="o">=</span> <span class="pn">[</span><span class="n">4</span><span class="pn">;</span> <span class="n">5</span><span class="pn">;</span> <span class="n">6</span><span class="pn">;</span> <span class="n">7</span><span class="pn">;</span> <span class="n">8</span><span class="pn">;</span> <span class="n">9</span><span class="pn">]</span>
<span class="k">val</span> <span class="id">table&#39;3</span> <span class="pn">:</span> <span onmouseout="hideTip(event, '11', 57)" onmouseover="showTip(event, '11', 57)" class="id">int</span> <span onmouseout="hideTip(event, '12', 58)" onmouseover="showTip(event, '12', 58)" class="id">list</span> <span class="o">=</span>
  <span class="pn">[</span><span class="n">5</span><span class="pn">;</span> <span class="n">6</span><span class="pn">;</span> <span class="n">7</span><span class="pn">;</span> <span class="n">8</span><span class="pn">;</span> <span class="n">9</span><span class="pn">;</span> <span class="n">10</span><span class="pn">;</span> <span class="n">6</span><span class="pn">;</span> <span class="n">7</span><span class="pn">;</span> <span class="n">8</span><span class="pn">;</span> <span class="n">9</span><span class="pn">;</span> <span class="n">10</span><span class="pn">;</span> <span class="n">11</span><span class="pn">;</span> <span class="n">7</span><span class="pn">;</span> <span class="n">8</span><span class="pn">;</span> <span class="n">9</span><span class="pn">;</span> <span class="n">10</span><span class="pn">;</span> <span class="n">11</span><span class="pn">;</span> <span class="n">12</span><span class="pn">;</span> <span class="n">8</span><span class="pn">;</span> <span class="n">9</span><span class="pn">;</span> <span class="n">10</span><span class="pn">;</span> <span class="n">11</span><span class="pn">;</span>
   <span class="n">12</span><span class="pn">;</span> <span class="n">13</span><span class="pn">;</span> <span class="n">9</span><span class="pn">;</span> <span class="n">10</span><span class="pn">;</span> <span class="n">11</span><span class="pn">;</span> <span class="n">12</span><span class="pn">;</span> <span class="n">13</span><span class="pn">;</span> <span class="n">14</span><span class="pn">]</span>
</code></pre></td>
</tr>
</table>
</blockquote>
<p>By allowing mutation, we've increased the element of surprise.  I have found this aspect of mutation especially difficult to reason about in large code bases.</p>
<p>Restrictions are not always an inhibitor, rather they can play a central role in improving the speed and effeciency in development.</p>
<script src="/assets/vendor/jquery/jquery.min.js"></script><script src="/assets/vendor/jquery-easing/jquery.easing.min.js"></script><script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script><script src="/assets/js/literate.js"></script></div></body></html>